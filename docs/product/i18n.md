# Internationalization (i18n) Guide

## Overview

RealRiches uses [next-intl](https://next-intl-docs.vercel.app/) v4.7.0 for internationalization with Next.js 15 App Router.

## Supported Locales

| Locale | Language | Currency | Status |
|--------|----------|----------|--------|
| `en`   | English  | USD      | Default |
| `es`   | Spanish  | USD      | Active |
| `fr`   | French   | EUR      | Active |

## Architecture

### File Structure

```
apps/web/src/
â”œâ”€â”€ i18n/
â”‚   â”œâ”€â”€ config.ts          # Locale definitions and validation
â”‚   â””â”€â”€ request.ts         # Server-side message loading
â”œâ”€â”€ messages/
â”‚   â”œâ”€â”€ en.json            # English translations
â”‚   â”œâ”€â”€ es.json            # Spanish translations
â”‚   â””â”€â”€ fr.json            # French translations
â”œâ”€â”€ components/
â”‚   â””â”€â”€ LanguageSwitcher.tsx  # Language selection dropdown
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ formatting.ts      # Locale-aware formatters
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useFormatters.ts   # React hook for formatting
â””â”€â”€ middleware.ts          # Locale detection middleware
```

### Routing

- URL prefix strategy: `as-needed` (shows `/es`, `/fr` but hides `/en` for default)
- Route segment: `app/[locale]/` wraps all localized pages
- Middleware handles locale detection from:
  1. URL path
  2. Cookies
  3. `Accept-Language` header

## Adding a New Locale

### Step 1: Update Config

Edit `apps/web/src/i18n/config.ts`:

```typescript
export const locales = ['en', 'es', 'fr', 'de'] as const;  // Add 'de'

export const localeNames: Record<Locale, string> = {
  en: 'English',
  es: 'Espanol',
  fr: 'Francais',
  de: 'Deutsch',  // Add German
};

export const localeFlags: Record<Locale, string> = {
  en: 'ðŸ‡ºðŸ‡¸',
  es: 'ðŸ‡ªðŸ‡¸',
  fr: 'ðŸ‡«ðŸ‡·',
  de: 'ðŸ‡©ðŸ‡ª',  // Add flag
};
```

### Step 2: Create Message File

Copy `apps/web/src/messages/en.json` to `apps/web/src/messages/de.json` and translate all values.

### Step 3: Update Request Config

Edit `apps/web/src/i18n/request.ts`:

```typescript
async function loadMessages(locale: Locale): Promise<Messages> {
  switch (locale) {
    case 'de':
      return (await import('../messages/de.json')) as Messages;
    case 'fr':
      return (await import('../messages/fr.json')) as Messages;
    case 'es':
      return (await import('../messages/es.json')) as Messages;
    case 'en':
    default:
      return (await import('../messages/en.json')) as Messages;
  }
}
```

### Step 4: Update Tests

Add the new locale to `apps/web/src/__tests__/i18n.test.ts`:

```typescript
import deMessages from '../messages/de.json';

// Add tests for new locale
describe('German Messages', () => {
  // ...
});
```

### Step 5: Update Formatting (Optional)

If the new locale uses a different currency, update `apps/web/src/lib/formatting.ts`:

```typescript
const localeCurrencies: Record<Locale, string> = {
  en: 'USD',
  es: 'USD',
  fr: 'EUR',
  de: 'EUR',  // Add currency
};
```

## Translation Keys

### Message Namespaces

| Namespace | Purpose |
|-----------|---------|
| `common` | Shared UI elements (loading, save, cancel) |
| `auth` | Authentication (login, register, password) |
| `navigation` | Menu items |
| `dashboard` | Dashboard-specific content |
| `listings` | Property listings |
| `properties` | Property management |
| `compliance` | Compliance terminology |
| `disclosures` | Legal disclosure text |
| `roles` | User role labels |
| `toasts` | Toast notifications |
| `forms` | Form labels and validation |
| `errors` | Error messages |
| `landing` | Landing page content |
| `activity` | Activity feed |
| `maintenance` | Maintenance priorities |
| `metadata` | SEO titles/descriptions |

### Compliance-Critical Keys

These keys contain legally required text and MUST be professionally translated:

```json
{
  "disclosures": {
    "fareAct": { "title": "...", "content": "..." },
    "leadPaint": { "title": "...", "content": "..." },
    "bedbug": { "title": "...", "content": "..." },
    "fairHousing": { "title": "...", "content": "..." },
    "goodCauseEviction": { "title": "...", "content": "..." }
  }
}
```

## Usage in Components

### Server Components

```tsx
import { getTranslations } from 'next-intl/server';

export default async function Page() {
  const t = await getTranslations('dashboard');
  return <h1>{t('title')}</h1>;
}
```

### Client Components

```tsx
'use client';

import { useTranslations } from 'next-intl';

export function DashboardNav() {
  const t = useTranslations('navigation');
  return <nav>{t('dashboard')}</nav>;
}
```

### With Interpolation

```tsx
// Message: "welcomeBack": "Welcome back, {name}"
const t = useTranslations('dashboard');
<p>{t('welcomeBack', { name: user.firstName })}</p>
```

### Plural Forms

```tsx
// Message: "bedrooms": "{count, plural, one {# bedroom} other {# bedrooms}}"
const t = useTranslations('listings');
<p>{t('bedrooms', { count: 3 })}</p>
```

## Formatting Helpers

### Using the Hook

```tsx
import { useFormatters } from '@/hooks/useFormatters';

function PriceDisplay({ amount }: { amount: number }) {
  const { formatCurrency } = useFormatters();
  return <span>{formatCurrency(amount)}</span>;  // "$1,234" or "1 234 â‚¬"
}
```

### Available Formatters

| Function | Description | Example |
|----------|-------------|---------|
| `formatCurrency(amount)` | Format as currency | `$1,234.56` / `1 234,56 â‚¬` |
| `formatDate(date, options?)` | Format date | `Mar 15, 2024` / `15 mars 2024` |
| `formatNumber(num, options?)` | Format number | `1,234.56` / `1 234,56` |
| `formatPercent(value)` | Format percentage | `75%` / `75 %` |
| `formatRelativeTime(date)` | Relative time | `2 hours ago` / `il y a 2 heures` |

## Language Switcher

The `LanguageSwitcher` component is included in the dashboard layout sidebar.

### Usage

```tsx
import { LanguageSwitcher } from '@/components/LanguageSwitcher';

// Default (shows flag, name)
<LanguageSwitcher />

// Compact (flag only)
<LanguageSwitcher variant="compact" />

// Custom styling
<LanguageSwitcher className="my-custom-class" />
```

## SEO Considerations

- `generateStaticParams` exports all locales for static generation
- Root layout sets `lang={locale}` attribute on `<html>`
- Middleware uses `localePrefix: 'as-needed'` to avoid duplicate content

### Future Enhancements

- Add `hreflang` meta tags for alternate language pages
- Implement locale-specific sitemaps

## Testing

Run i18n tests:

```bash
cd apps/web
pnpm test -- i18n
pnpm test -- formatting
```

### Test Coverage

- Locale configuration validation
- Message parity across all locales
- Translation content verification
- Formatting output validation

## Best Practices

1. **Never hardcode user-facing text** - Always use translation keys
2. **Keep keys semantic** - `auth.loginButton` not `auth.blueButton`
3. **Use namespaces** - Group related keys together
4. **Test parity** - Ensure all locales have the same keys
5. **Professional translation** - Use translators for compliance text
6. **Avoid concatenation** - Use interpolation instead

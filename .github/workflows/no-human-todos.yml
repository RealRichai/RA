name: Policy - No HUMAN_IMPLEMENTATION_REQUIRED in Source

on:
  pull_request:
  push:
    branches:
      - main
      - canonical-main
      - canonical-main-v2

jobs:
  no-human-todos:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: sudo apt-get update && sudo apt-get install -y ripgrep
      - name: Policy - block HUMAN_IMPLEMENTATION_REQUIRED in source
        run: |
          set -euo pipefail
          if rg -n "HUMAN_IMPLEMENTATION_REQUIRED" apps packages prisma docs \
              -g'!**/coverage/**' \
              -g'!**/.next/**' \
              -g'!**/dist/**' \
              -g'!**/.turbo/**' ; then
            echo "ERROR: Found HUMAN_IMPLEMENTATION_REQUIRED in source."
            exit 1
          fi
